<div class="padded" style="align-items: center;">
  <mat-form-field style="width: 500px">
    <mat-select [(value)]="selectedOption" >
      <mat-option [value]="-1">ყველა პროდუქტი და მომსახურება</mat-option>
      <mat-option *ngFor="let product of (checked ? userBonuses : userSales); let i = index" [value]="i">
        {{product?.product.name}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-slide-toggle
    [checked]="checked"
    (change)="onSlideChange()">{{!checked ? 'რაოდენობა' : 'თანხა' }}
  </mat-slide-toggle>
</div>
<mat-divider></mat-divider>
<mat-grid-list [cols]="selectedOption > -1 ? 5 : 3" rowHeight="130px">
  <mat-grid-tile>
    <mat-card>
      <mat-card-header>
        <mat-card-title>{{checked ? 'ჩემი თანხა' : 'ჩემი ოპერაციები' }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="card-number" *ngIf="!checked">{{user?.userStaffLevel === 'MIDDLE_MANAGER' ? branchTotalOperations?.currentBranchSales.toLocaleString() : selectedOption > -1 ? userSales[selectedOption].userResult.toLocaleString() : salesTotalQuantityPrimary?.toLocaleString()}}</p>
        <p class="card-number" *ngIf="checked">{{user?.userStaffLevel === 'MIDDLE_MANAGER' ? branchTotalOperations?.currentBranchSales.toLocaleString() : selectedOption > -1 ? (userBonuses[selectedOption].userResult/100).toLocaleString()+' ლ' : (myBonusInGel/100)?.toLocaleString()+' ლ'}}</p>
      </mat-card-content>
    </mat-card>
  </mat-grid-tile>
  <mat-grid-tile>
    <mat-card>
      <mat-card-header>
        <mat-card-title>ბანკის საშუალო</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="card-number" *ngIf="!checked">{{user?.userStaffLevel === 'MIDDLE_MANAGER' ? branchTotalOperations?.branchesMean : selectedOption > -1 ? userSales[selectedOption].bankAverage : bankAvgOperations.toLocaleString()}}</p>
        <p class="card-number" *ngIf="checked">{{user?.userStaffLevel === 'MIDDLE_MANAGER' ? branchTotalOperations?.branchesMean : selectedOption > -1 ? (userBonuses[selectedOption].bankAverage/100)+' ლ' : (bankAvarageBonus/100).toLocaleString()+' ლ'}}</p>
      </mat-card-content>
    </mat-card>
  </mat-grid-tile>
  <mat-grid-tile>
    <mat-card>
      <mat-card-header>
        <mat-card-title>ბანკის მაქსიმუმი</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="card-number" *ngIf="!checked">{{user?.userStaffLevel === 'MIDDLE_MANAGER' ? branchTotalOperations?.branchesMax : selectedOption > -1 ? userSales[selectedOption].bankmax : bankMaxOperations.toLocaleString()}}</p>
        <p class="card-number" *ngIf="checked">{{user?.userStaffLevel === 'MIDDLE_MANAGER' ? branchTotalOperations?.branchesMax : selectedOption > -1 ? (userBonuses[selectedOption].bankmax/100)+' ლ' : (bankMaxBonusPoints/100).toLocaleString()+' ლ'}}</p>
      </mat-card-content>
    </mat-card>
  </mat-grid-tile>
  <mat-grid-tile *ngIf="selectedOption > -1 && user?.userStaffLevel !== 'MIDDLE_MANAGER'">
    <mat-card>
      <mat-card-header>
        <mat-card-title>ჯგუფის საშუალო</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="card-number" *ngIf="!checked">{{userSales[selectedOption].groupAverage}}</p>
        <p class="card-number" *ngIf="checked">{{(userBonuses[selectedOption].groupAverage/100)+' ლ'}}</p>
      </mat-card-content>
    </mat-card>
  </mat-grid-tile>
  <mat-grid-tile *ngIf="selectedOption > -1 && user?.userStaffLevel !== 'MIDDLE_MANAGER'">
    <mat-card>
      <mat-card-header>
        <mat-card-title>ჯგუფის მაქსიმუმი</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p class="card-number" *ngIf="!checked">{{userSales[selectedOption].groupMax.toLocaleString()}}</p>
        <p class="card-number" *ngIf="checked">{{(userBonuses[selectedOption].groupMax/100).toLocaleString()+' ლ'}}</p>
      </mat-card-content>
    </mat-card>
  </mat-grid-tile>
</mat-grid-list>
<div class="scrolled-container-center">
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        ძირითადი პროდუქტი
      </mat-panel-title>
      <mat-panel-description>
        {{checked ?  'ლარი: ' + (bonusTotalQuantityPrimary/100)?.toLocaleString() : 'ოპერაცია: ' + salesTotalQuantityPrimary?.toLocaleString() }}
      </mat-panel-description>
    </mat-expansion-panel-header>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          მოზიდვა
        </mat-panel-title>
        <mat-panel-description>

        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-container *ngFor="let data of userSales">
        <div class="progress-bar__container"
             *ngIf="data.product.primary && data.product.productMotivationalBlockType === 'ACQUISITION'">
          <div class="progress-bar__labels">
            <div class="progress-bar__labels-left" routerLink="/product">
              {{data.product.name}}
            </div>
          </div>
          <div class="triangle-up" style="border-top: 10px solid red"
               [ngStyle]="{left: (data.competenceLevel.productMinSales/data.bankmax * 100) + '%', display: data.competenceLevel.productMinSales === 0 ? 'none' : ''}"
               [matTooltip]="'მინიმალური ზღვარი ' + data.competenceLevel.productMinSales"
               matTooltipPosition="above"></div>
          <mat-icon class="triangle"
               [ngStyle]="{left: (data.userResult/data.bankmax * 100) > 95 ? '95%' : (data.userResult/data.bankmax * 100) + '%', color: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red'}"
               [matTooltip]="'ჩემი შედეგი ' + data.userResult"
               matTooltipPosition="above">{{data.competenceLevel.productMinSales > data.userResult ? 'sentiment_very_dissatisfied' : 'sentiment_satisfied'}}</mat-icon>
          <mat-icon class="triangle-down" style="color: blue"
               [ngStyle]="{left: (data.groupAverage/data.bankmax * 100) > 95 ? '95%' : (data.groupAverage/data.bankmax * 100) + '%'}"
               [matTooltip]="'ჯგუფის საშუალო ' + data.groupAverage"
               matTooltipPosition="above">group</mat-icon>
          <img src="../../images/groupMax.png" class="triangle"
               [ngStyle]="{left: (data.groupMax/data.bankmax * 100) > 95 ? '95%' : (data.groupMax/data.bankmax * 100) + '%'}"
               [matTooltip]="'ჯგუფის მაქსიმუმი ' + data.groupMax"
               matTooltipPosition="above">
          <i class="fa fa-users triangle-down" style="color: #f067ff; top:8px; font-size: 0.9rem"
               [ngStyle]="{left: (data.bankAverage/data.bankmax * 100) > 95 ? '95%' : (data.bankAverage/data.bankmax * 100) + '%'}"
               [matTooltip]="'ბანკის საშუალო ' + data.bankAverage"
               matTooltipPosition="above"></i>
          <img src="../../images/bankMax.png" class="triangle-down"  [ngStyle]="{left: '95%'}"
               [matTooltip]="'ბანკის მაქსიმუმი ' + data.bankmax"
               matTooltipPosition="above">
          <div class="progress-bar__level1" [ngStyle]="{ backgroundColor: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red' }">
          </div>
        </div>

      </ng-container>
    </mat-expansion-panel>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          დაკრედიტება
        </mat-panel-title>
        <mat-panel-description>

        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-container *ngFor="let data of userSales">
        <div class="progress-bar__container"
             *ngIf="data.product.primary && data.product.productMotivationalBlockType === 'CREDIT_ISSUANCE'">
          <div class="progress-bar__labels">
            <div class="progress-bar__labels-left" routerLink="/product">
              {{data.product.name}}
            </div>
          </div>
          <div class="triangle-up" style="border-top: 10px solid red"
               [ngStyle]="{left: (data.competenceLevel.productMinSales/data.bankmax * 100) + '%', display: data.competenceLevel.productMinSales === 0 ? 'none' : ''}"
               [matTooltip]="'მინიმალური ზღვარი ' + data.competenceLevel.productMinSales"
               matTooltipPosition="above"></div>
          <mat-icon class="triangle"
                    [ngStyle]="{left: (data.userResult/data.bankmax * 100) > 95 ? '95%' : (data.userResult/data.bankmax * 100) + '%', color: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red'}"
                    [matTooltip]="'ჩემი შედეგი ' + data.userResult"
                    matTooltipPosition="above">{{data.competenceLevel.productMinSales > data.userResult ? 'sentiment_very_dissatisfied' : 'sentiment_satisfied'}}</mat-icon>
          <mat-icon class="triangle-down" style="color: blue"
                    [ngStyle]="{left: (data.groupAverage/data.bankmax * 100) > 95 ? '95%' : (data.groupAverage/data.bankmax * 100) + '%'}"
                    [matTooltip]="'ჯგუფის საშუალო ' + data.groupAverage"
                    matTooltipPosition="above">group</mat-icon>
          <i class="fa fa-tachometer triangle" style="font-size: 1rem"
             [ngStyle]="{left: (data.groupMax/data.bankmax * 100) > 95 ? '95%' : (data.groupMax/data.bankmax * 100) + '%'}"
             [matTooltip]="'ჯგუფის მაქსიმუმი ' + data.groupMax"
             matTooltipPosition="above"></i>
          <i class="fa fa-users triangle-down" style="color: #f067ff; top:8px; font-size: 0.9rem"
             [ngStyle]="{left: (data.bankAverage/data.bankmax * 100) > 95 ? '95%' : (data.bankAverage/data.bankmax * 100) + '%'}"
             [matTooltip]="'ბანკის საშუალო ' + data.bankAverage"
             matTooltipPosition="above"></i>
          <mat-icon class="triangle-down"  [ngStyle]="{left: '95%'}"
                    [matTooltip]="'ბანკის მაქსიმუმი ' + data.bankmax"
                    matTooltipPosition="above">shutter_speed</mat-icon>
          <div class="progress-bar__level1" [ngStyle]="{ backgroundColor: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red' }">
          </div>
        </div>

      </ng-container>
    </mat-expansion-panel>
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          მომსახურება
        </mat-panel-title>
        <mat-panel-description>

        </mat-panel-description>
      </mat-expansion-panel-header>
      <ng-container *ngFor="let data of userSales">
        <div class="progress-bar__container"
             *ngIf="data.product.primary && data.product.productMotivationalBlockType === 'SERVICE'">
          <div class="progress-bar__labels">
            <div class="progress-bar__labels-left" routerLink="/product">
              {{data.product.name}}
            </div>
          </div>
          <div class="triangle-up" style="border-top: 10px solid red"
               [ngStyle]="{left: (data.competenceLevel.productMinSales/data.bankmax * 100) + '%', display: data.competenceLevel.productMinSales === 0 ? 'none' : ''}"
               [matTooltip]="'მინიმალური ზღვარი ' + data.competenceLevel.productMinSales"
               matTooltipPosition="above"></div>
          <mat-icon class="triangle"
                    [ngStyle]="{left: (data.userResult/data.bankmax * 100) > 95 ? '95%' : (data.userResult/data.bankmax * 100) + '%', color: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red'}"
                    [matTooltip]="'ჩემი შედეგი ' + data.userResult"
                    matTooltipPosition="above">{{data.competenceLevel.productMinSales > data.userResult ? 'sentiment_very_dissatisfied' : 'sentiment_satisfied'}}</mat-icon>
          <mat-icon class="triangle-down" style="color: blue"
                    [ngStyle]="{left: (data.groupAverage/data.bankmax * 100) > 95 ? '95%' : (data.groupAverage/data.bankmax * 100) + '%'}"
                    [matTooltip]="'ჯგუფის საშუალო ' + data.groupAverage"
                    matTooltipPosition="above">group</mat-icon>
          <i class="fa fa-tachometer triangle" style="font-size: 1rem"
             [ngStyle]="{left: (data.groupMax/data.bankmax * 100) > 95 ? '95%' : (data.groupMax/data.bankmax * 100) + '%'}"
             [matTooltip]="'ჯგუფის მაქსიმუმი ' + data.groupMax"
             matTooltipPosition="above"></i>
          <i class="fa fa-users triangle-down" style="color: #f067ff; top:8px; font-size: 0.9rem"
             [ngStyle]="{left: (data.bankAverage/data.bankmax * 100) > 95 ? '95%' : (data.bankAverage/data.bankmax * 100) + '%'}"
             [matTooltip]="'ბანკის საშუალო ' + data.bankAverage"
             matTooltipPosition="above"></i>
          <mat-icon class="triangle-down"  [ngStyle]="{left: '95%'}"
                    [matTooltip]="'ბანკის მაქსიმუმი ' + data.bankmax"
                    matTooltipPosition="above">shutter_speed</mat-icon>
          <div class="progress-bar__level1" [ngStyle]="{ backgroundColor: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red' }">
          </div>
        </div>

      </ng-container>
    </mat-expansion-panel>
  </mat-expansion-panel>
  <mat-expansion-panel>
    <mat-expansion-panel-header>
      <mat-panel-title>
        სხვა პროდუქტი
      </mat-panel-title>
      <mat-panel-description>
        {{checked ? 'ლარი: '+(bonusTotalQuantityOther/100)?.toLocaleString()  :  'ოპერაცია: ' + salesTotalQuantityOther?.toLocaleString() }}
      </mat-panel-description>
    </mat-expansion-panel-header>
    <ng-container *ngFor="let data of userSales">
      <div class="progress-bar__container"
           *ngIf="!data.product.primary">
        <div class="progress-bar__labels">
          <div class="progress-bar__labels-left" routerLink="/product">
            {{data.product.name}}
          </div>
        </div>
        <div class="triangle-up" style="border-top: 10px solid red"
             [ngStyle]="{left: (data.competenceLevel.productMinSales/data.bankmax * 100) + '%', display: data.competenceLevel.productMinSales === 0 ? 'none' : ''}"
             [matTooltip]="'მინიმალური ზღვარი ' + data.competenceLevel.productMinSales"
             matTooltipPosition="above"></div>
        <mat-icon class="triangle"
                  [ngStyle]="{left: (data.userResult/data.bankmax * 100) > 95 ? '95%' : (data.userResult/data.bankmax * 100) + '%', color: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red'}"
                  [matTooltip]="'ჩემი შედეგი ' + data.userResult"
                  matTooltipPosition="above">{{data.competenceLevel.productMinSales > data.userResult ? 'sentiment_very_dissatisfied' : 'sentiment_satisfied'}}</mat-icon>
        <mat-icon class="triangle-down" style="color: blue"
                  [ngStyle]="{left: (data.groupAverage/data.bankmax * 100) > 95 ? '95%' : (data.groupAverage/data.bankmax * 100) + '%'}"
                  [matTooltip]="'ჯგუფის საშუალო ' + data.groupAverage"
                  matTooltipPosition="above">group</mat-icon>
        <i class="fa fa-tachometer triangle" style="font-size: 1rem"
           [ngStyle]="{left: (data.groupMax/data.bankmax * 100) > 95 ? '95%' : (data.groupMax/data.bankmax * 100) + '%'}"
           [matTooltip]="'ჯგუფის მაქსიმუმი ' + data.groupMax"
           matTooltipPosition="above"></i>
        <i class="fa fa-users triangle-down" style="color: #f067ff; top:8px; font-size: 0.9rem"
           [ngStyle]="{left: (data.bankAverage/data.bankmax * 100) > 95 ? '95%' : (data.bankAverage/data.bankmax * 100) + '%'}"
           [matTooltip]="'ბანკის საშუალო ' + data.bankAverage"
           matTooltipPosition="above"></i>
        <mat-icon class="triangle-down"  [ngStyle]="{left: '95%'}"
                  [matTooltip]="'ბანკის მაქსიმუმი ' + data.bankmax"
                  matTooltipPosition="above">shutter_speed</mat-icon>
        <div class="progress-bar__level1" [ngStyle]="{ backgroundColor: data.competenceLevel.productMinSales <= data.userResult ? 'green' : 'red' }">
        </div>
      </div>

    </ng-container>
  </mat-expansion-panel>
  <div class="title-header">
    <h5 class="text-left">
      გრაფიკული ანალიზი
    </h5>
  </div>
  <div class="padded" *ngIf="isDataAvailable && lineChartDataAvailable" style="padding: 0; margin-top: 30px">

    <canvas baseChart
            [datasets]="lineChartData"
            [labels]="lineChartLabels"
            [options]="lineChartOptions"
            [colors]="lineChartColors"
            [legend]="lineChartLegend"
            [chartType]="lineChartType"></canvas>

    <mat-form-field>
      <mat-select placeholder="აირჩიეთ პროდუქტი" [(value)]="selected.value"
                  (selectionChange)="loadLineChartData(selected.value)">
        <mat-option *ngFor="let product of lineChartArray.prorductsBonusesByMonths; let i = index" [value]="i ">{{product.product.name}}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
</div>
<div class="fixed-container-right" *ngIf="isDataAvailable">
    <div class="profile__doughnut-chart">
      <div class="title-header">
        <h5 class="text-left">
          ჩემი ბონუსი
        </h5>
      </div>
      <canvas height="120" width="120" baseChart
              [data]="doughnutChartData"
              [labels]="doughnutChartLabels"
              [chartType]="doughnutChartType"
              [options]="doughnutOptions"
              [colors]="doughnutChartColors"></canvas>
      <div class="profile__doughnut-chart--legend">
        <label class="chart-legend" *ngFor="let data of combinedArray"><span class="kvadrawik"
                                                                             [ngStyle]="{ backgroundColor: data.color }"></span>{{data.label}}</label>
      </div>
      <div class="doughnut-chart__label">
        <strong>{{myBonusInGel/100}}</strong>
        <label>ლარი</label>
      </div>
      <div class="doughnut-chart__rating-data">
        <div class="doughnut-chart__rating-data--right-side">
          <p>ბანკი</p>
          <p
            matTooltip="თქვენი რეიტინგი ბანკში ბონუსის მიხედვით"
            matTooltipPosition="above">{{myRatingByBonusPoints}}</p>
          <p
            matTooltip="ბანკში მაქსიმალური ბონუსი"
            matTooltipPosition="above">{{(bankMaxBonusPoints/100)?.toLocaleString()+' ლ'}}</p>
        </div>
      </div>
    </div>

</div>


